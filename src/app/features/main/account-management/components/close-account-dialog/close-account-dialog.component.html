<p-dialog
  [(visible)]="visible"
  (visibleChange)="visibleChange.emit($event)"
  [modal]="true"
  [draggable]="false"
  [resizable]="false"
  header="Close Your Account"
  styleClass="w-full max-w-lg mx-4 bg-background text-foreground rounded-lg shadow-xl"
>
  <!-- Custom Header Template -->
  <ng-template pTemplate="header">
    <div class="flex items-center">
      <i class="pi pi-exclamation-triangle text-red-400 text-2xl mr-3"></i>
      <div>
        <h2 class="text-xl font-bold text-foreground">Close Your Account</h2>
        <p class="text-sm text-secondary-100">
          This action is permanent and cannot be undone.
        </p>
      </div>
    </div>
  </ng-template>

  <form [formGroup]="closeAccountForm" (ngSubmit)="onSubmit()">
    <div class="py-4">
      <!-- Closure Reasons -->
      <div class="mb-6">
        <label class="font-semibold text-secondary-100 mb-3 block"
          >Please tell us why you're closing your account</label
        >
        <div class="flex flex-col space-y-3">
          <div *ngFor="let reason of closureReasons" class="flex items-center">
            <p-radioButton
              [name]="'reason'"
              [value]="reason.value"
              formControlName="reason"
              [inputId]="reason.value"
            >
            </p-radioButton>
            <label
              [for]="reason.value"
              class="ml-2 text-secondary-100 cursor-pointer"
              >{{ reason.label }}</label
            >
          </div>
        </div>
      </div>

      <!-- Additional Comments -->
      <div *ngIf="isOtherReasonSelected" class="mb-6">
        <label for="comments" class="font-semibold text-secondary-100 mb-2 block"
          >Additional Comments</label
        >
        <textarea
          id="comments"
          pInputTextarea
          formControlName="comments"
          placeholder="Please provide additional details"
          [autoResize]="true"
          rows="3"
          class="w-full "
          [ngClass]="{
            'ng-invalid ng-dirty':
              closeAccountForm.get('comments')?.invalid &&
              closeAccountForm.get('comments')?.touched
          }"
        >
        </textarea>
      </div>

      <!-- Balance Transfer Info -->
      <div
        class="bg-secondary border border-separate text-gray-200 text-sm p-4 rounded-lg"
      >
        Your remaining balance of
        <span class="font-bold text-foreground">{{
          balance | currency : currency : "symbol" : "1.2-2"
        }}</span>
        will be transferred to your nominated account within 5-7 business days.
      </div>
    </div>
  </form>

  <!-- Custom Footer -->
  <ng-template pTemplate="footer">
    <p-button
      label="Cancel"
      (click)="onCancel()"
      styleClass="p-button-secondary"
    >
    </p-button>
    <p-button
      label="Close Account Permanently"
      (click)="onSubmit()"
      [loading]="isSubmitting"
      [disabled]="closeAccountForm.invalid || isSubmitting"
      styleClass="p-button-danger"
    >
    </p-button>
  </ng-template>
</p-dialog>
